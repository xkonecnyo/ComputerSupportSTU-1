## Task 3 – Expanding Your Universe

```{r}
# 3.1 The Quest: Find Your Data
# Data from: https://simplemaps.com/data/world-cities (Chile subset)

# 3.2 The Import: Load Your Data
library(dplyr)
library(readr)
library(readxl)

# načítanie Excel datasetu (Chile cities)
chile_data <- read_excel("cl.xlsx")

# prvá kontrola dát
glimpse(chile_data)
head(chile_data)
summary(chile_data)

# 3.3 The Interrogation: Explore with dplyr

# Question 1: Ktoré 5 miest má najvyššiu populáciu?
chile_data %>%
  select(city, population) %>%
  arrange(desc(population)) %>%
  head(5)

# Question 2: Aká je priemerná populácia podľa administratívneho regiónu?
chile_data %>%
  group_by(admin_name) %>%
  summarise(avg_population = mean(population, na.rm = TRUE)) %>%
  arrange(desc(avg_population))

# Question 3: Ktoré mestá sú hlavné (capital) a akú majú populáciu?
chile_data %>%
  filter(capital %in% c("primary", "admin", "minor")) %>%
  select(city, capital, population) %>%
  arrange(desc(population))

# Question 4: Vypočítaj proxy hustotu populácie (populácia / vzdialenosť od rovníka v stupňoch lat).
chile_data %>%
  mutate(lat_distance = abs(lat),
         density_proxy = population / lat_distance) %>%
  select(city, population, lat_distance, density_proxy) %>%
  arrange(desc(density_proxy)) %>%
  head(10)

# Question 5: Koľko miest je v každom administratívnom regióne?
chile_data %>%
  group_by(admin_name) %>%
  summarise(city_count = n()) %>%
  arrange(desc(city_count))
